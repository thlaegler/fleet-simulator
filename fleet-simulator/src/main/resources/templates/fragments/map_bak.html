<html xmlns="http://www.w3.org/1999/xhtml"
	xmlns:th="http://www.thymeleaf.org"
	xmlns:sec="http://www.thymeleaf.org/thymeleaf-extras-springsecurity4">

<div th:fragment="functions">

	<script th:src="|http://maps.googleapis.com/maps/api/js?key=${apiKey}|">
	</script>


	<script th:inline="text">
        /*<![CDATA[*/
                   
		/*
		*   //var vehicles = [[${vehicles}]];
		*	var myCenter = new google.maps.LatLng([[@{|${vehicle1.position.lat},${vehicle1.position.lng}|}]]);
		*	var vehicles = { '[[${vehicle0.licencePlate}]]' : new google.maps.LatLng([[@{|${vehicle0.position.lat},${vehicle0.position.lng}|}]]), 
		*		'[[${vehicle1.licencePlate}]]' : new google.maps.LatLng([[@{|${vehicle1.position.lat},${vehicle1.position.lng}|}]]),
		*		'[[${vehicle2.licencePlate}]]' : new google.maps.LatLng([[@{|${vehicle2.position.lat},${vehicle2.position.lng}|}]]),
		*		'[[${vehicle3.licencePlate}]]' : new google.maps.LatLng([[@{|${vehicle3.position.lat},${vehicle3.position.lng}|}]]),
		*		'[[${vehicle4.licencePlate}]]' : new google.maps.LatLng([[@{|${vehicle4.position.lat},${vehicle4.position.lng}|}]]),
		*		'[[${vehicle5.licencePlate}]]' : new google.maps.LatLng([[@{|${vehicle5.position.lat},${vehicle5.position.lng}|}]]),
		*		'[[${vehicle6.licencePlate}]]' : new google.maps.LatLng([[@{|${vehicle6.position.lat},${vehicle6.position.lng}|}]]),
		*		'[[${vehicle7.licencePlate}]]' : new google.maps.LatLng([[@{|${vehicle7.position.lat},${vehicle7.position.lng}|}]])
		*	};
		*/
		
		//var vehicles = [[${vehicles}]];
		var myCenter = new google.maps.LatLng([[@{|${vehicle1.position.lat},${vehicle1.position.lng}|}]]);
		var vehicles = { '[[${vehicle0.licencePlate}]]' : new google.maps.LatLng([[@{|${vehicle0.position.lat},${vehicle0.position.lng}|}]]), 
			'[[${vehicle1.licencePlate}]]' : new google.maps.LatLng([[@{|${vehicle1.position.lat},${vehicle1.position.lng}|}]]),
			'[[${vehicle2.licencePlate}]]' : new google.maps.LatLng([[@{|${vehicle2.position.lat},${vehicle2.position.lng}|}]]),
			'[[${vehicle3.licencePlate}]]' : new google.maps.LatLng([[@{|${vehicle3.position.lat},${vehicle3.position.lng}|}]]),
			'[[${vehicle4.licencePlate}]]' : new google.maps.LatLng([[@{|${vehicle4.position.lat},${vehicle4.position.lng}|}]]),
			'[[${vehicle5.licencePlate}]]' : new google.maps.LatLng([[@{|${vehicle5.position.lat},${vehicle5.position.lng}|}]]),
			'[[${vehicle6.licencePlate}]]' : new google.maps.LatLng([[@{|${vehicle6.position.lat},${vehicle6.position.lng}|}]]),
			'[[${vehicle7.licencePlate}]]' : new google.maps.LatLng([[@{|${vehicle0.position.lat},${vehicle7.position.lng}|}]])
		};
        console.log(vehicles);
        
		function initialize() {
			var mapProp = {
				center : myCenter,
				zoom : 14,
				mapTypeId : 'roadmap'
			};
			var map = new google.maps.Map(document.getElementById("googleMap"),
					mapProp);
			
			for(var plate in vehicles) {
				var marker = new google.maps.Marker({
					position : vehicles[plate],
					title: plate,
					icon: {
				      url: 'https://github.com/google/material-design-icons/blob/master/maps/drawable-mdpi/ic_local_taxi_black_24dp.png?raw=true'
				   	}
				});
				
				var contentString = '<div>' + plate + '</div>';
				var infowindow = new google.maps.InfoWindow({
				    content: contentString
				  });
				marker.addListener('click', function() {
				    infowindow.open(map, marker);
				  });
				infowindow.open(map, marker)
				marker.setMap(map);
			}
			
			var marker = new google.maps.Marker({
				position : myCenter,
				title: '[[${vehicle1.licencePlate}]]',
				icon: {
			      url: 'https://github.com/google/material-design-icons/blob/master/maps/drawable-mdpi/ic_local_taxi_black_24dp.png?raw=true'
			    }
			});
			
			var contentString = '<div>[[${vehicle1.licencePlate}]]</div>';
			var infowindow = new google.maps.InfoWindow({
			    content: contentString
			  });
			marker.addListener('click', function() {
			    infowindow.open(map, marker);
			  });
			infowindow.open(map, marker)
			marker.setMap(map);
		}
		google.maps.event.addDomListener(window, 'load', initialize);
        /*]]>*/
	    </script>

</div>
</html>